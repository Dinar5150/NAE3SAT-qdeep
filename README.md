# Not-All-Equal 3-Satisfiability (NAE3SAT)

NAE3SAT is an [NP-complete](https://en.wikipedia.org/wiki/NP-completeness)
Boolean satisfiability (SAT) problem that has clauses of three literals each and
requires that for every clause the literals are not all equal to each other; i.e.,
all configurations are valid except {$-1, -1, -1$} and {$+1, +1, +1$} (for
spin-valued variables, or {$0,0,0$} and {$1, 1, 1$} for binary-valued variables).

---
**SAT Terminology:**

The [SAT problem](https://en.wikipedia.org/wiki/Boolean_satisfiability_problem)
problem is to decide whether the literals in its clauses can be assigned values
that satisfy all the clauses. In CNF, the SAT is satisfied only if all its
clauses are satisfied.

 * *Literal* is a Boolean variable such as $x$ and its negation, $\bar x$.
 * *Clause* is a disjunction of literals such as $x_0 \vee x_1$.
 * *conjunctive normal form (CNF)* conjoins clauses by the AND operator; i.e.,
   (clause 1) $\wedge$ (clause 2) $\wedge$ (clause 3).

---

NAE3SAT problems are known to transition from the satisfiable to the unsatisfiable
regime at a clause-to-variable ratio $\rho=2.1$. This code example solves problems
with $\rho=2.1$ (critical point) as well as with $\rho=3.0$ (max-SAT regime).

This example explores solving this satisfiability problem with two different
generations of D-Wave quantum computers:

* A Pegasus-[topology](https://docs.ocean.dwavesys.com/en/stable/concepts/topology.html)
  Advantage system.
* An experimental prototype of a Zephyr-topology quantum processing unit (QPU)
  for the Advantage2 next-generation system currently under development.

## Installation

You can run this example
[in the Leap IDE](https://ide.dwavesys.io/#https://github.com/dwave-examples/NAE3SAT).

Alternatively, install requirements locally (ideally, in a virtual environment):

    pip install -r requirements.txt

## Usage

To run the example:
```bash
python nae3sat_example.py
```

## Code Overview

The code reformulates NAE3SAT instances as Ising problems, embeds these onto the
QPU graphs, and analyzes the solution quality obtained from both QPUs.

### Ising Formulation

NAE3SAT problems can be mapped to the
[Ising model](https://docs.ocean.dwavesys.com/en/stable/concepts/bqm.html) by
anti-ferromagnetically coupling the variables of a clause. For example, a clause
for variables {$s_0$, $s_1$, $s_2$} is represented by the Ising Hamiltonian,

$H(s_0, s_1, s_2) = s_0s_1 + s_1 s_2 + s_2 s_0$.

The table below shows the energy for all configurations of the variables. The
valid not-all-equal configurations have a lower energy than the all-equal ones.

|$s_0$| $s_1$|$s_2$|$E$|
|---:|---:|---:|---:|
|-1| -1| -1|3|
| 1| -1| -1|-1|
| 1|  1| -1|-1|
|-1|  1| -1|-1|
|-1|  1|  1|-1|
| 1|  1|  1|3|
| 1| -1|  1|-1|
|-1| -1|  1|-1|

Negated variables are represented by a spin-reverse transform that variable. For
example, a clause with $\bar{s_1}$, the negation of $s_1$, is represented by the
Ising Hamiltonian,

$H(s_0, \bar{s_1}, s_2) = -s_0s_1 -s_1 s_2 + s_2 s_0$.

A full NAE3SAT problem is generated by adding clauses together:

$H(s_0, \dots, s_N) = H(s_0, s_1, s_2) + H(s_6, \bar{s_1}, s_4) + H(\bar{s_3}, s_5, \bar{s_9}) + \dots$

For more information on reformulating SAT problems in Ising format, see the
[system documentation](https://docs.dwavesys.com/docs/latest/handbook_reformulating.html).

### Embedding

Both the Pegasus and Zephyr topology have native graph triangles that allow
[embedding](https://docs.ocean.dwavesys.com/en/stable/concepts/embedding.html)
individual clauses directly (without chains). Nevertheless, a full problem
typically includes interactions between variables that are not natively connected
and do require chains.

Here we minor-embed the problems into the two topologies using the `minorminer` heuristic in D-Wave Ocean.

The graphic below shows the distribution of chain lengths in the embeddings of a
$\rho=3.0$ NAE3SAT problem minor-embedded into the two topologies using the
Ocean software's
[minorminer](https://docs.ocean.dwavesys.com/en/stable/docs_minorminer/source/sdk_index.html)
heuristic.

![](/readme_images/rho_300_chain_length.png)

The Zephyr topology of the Advantage2 prototype has a greater connectivity than
the Pegasus topology of Advantage. This allows for the minor-embedding of problems
more compactly (with shorter chains) in the Advantage2 prototype. More compact
embeddings typically improve the success of quantum-annealing computations.

Note that the data displayed above was generated for a particular execution of
this code example; results will slightly vary from run to run.

### Solution Analysis

The graphic below shows the solution quality of 100 samples from a $\rho=3.0$ problem.

![](/readme_images/rho_300_energies.png)

The Advantage2 prototype tends to obtain lower energy samples than Advantage.

## License

Released under the Apache License 2.0. See [LICENSE](LICENSE) file.
