# Not-All-Equal 3-Satisfiability (NAE3SAT)

NAE3SAT is an [NP-complete](https://en.wikipedia.org/wiki/NP-completeness)
Boolean satisfiability (SAT) problem that has clauses of three literals each and
requires that for every clause the literals are not all equal to each other; i.e.,
all configurations except `-1, -1, -1` and `+1, +1, +1` (for spin-valued variables,
or `0,0,0` and `1, 1, 1` for binary-valued variables) are valid.

---
**SAT Terminology:**

The [SAT problem](https://en.wikipedia.org/wiki/Boolean_satisfiability_problem)
problem is to decide whether the literals in its clauses can be assigned values
that satisfy all the clauses; i.e., produce a value of :math:`1`. In CNF, the SAT
is satisfied only if all its clauses are satisfied.

 * *Literal* is a Boolean variable such as `x` and its negation, NOT `x`.
 * *Clause* is a disjunction of literals such as `x` OR `y`.
 * *conjunctive normal form (CNF)* conjoins clauses by the AND operator; i.e.,
   (clause 1) AND (clause 2) AND (clause 3).

---

This example explores the process of solving these type of satisfiability
instances with two different generations of D-Wave quantum computers:

* A Pegasus-topology Advantage system
* An experimental prototype of a Zephyr-topology quantum processing unit (QPU)
  for the next-generation Advantage2 system currently under development.

The solution process includes reformulating NAE3SAT instances as Ising problems,
embedding these onto the QPU graphs, and analyzing the solution quality obtained
from both QPUs.

# Usage

To run the example:
```bash
python nae3sat_example.py
```

# Example

**Note:** The data in this document was generated with this code example, but results will slightly vary from run to run.

## Ising Formulation

NAE3SAT problems can be mapped to the Ising model by anti-ferromagnetically coupling the variables of a clause. As an example here we show a clause for variables {$s_0$, $s_1$, $s_2$}:

$H(s_0, s_1, s_2) = s_0s_1 + s_1 s_2 + s_2 s_0$

Note below that the not-all-equal confiurations have a lower energy than the all-equal ones.

|$s_0$| $s_1$|$s_2$|$E$|
|---:|---:|---:|---:|
|-1| -1| -1|3|
| 1| -1| -1|-1|
| 1|  1| -1|-1|
|-1|  1| -1|-1|
|-1|  1|  1|-1|
| 1|  1|  1|3|
| 1| -1|  1|-1|
|-1| -1|  1|-1|

If a variable is negated, we spin-reverse transform that variable. For example, if we negate $s_1$ (denoted by $\bar{s_1}$), the Ising Hamiltonian of that clause would take the following form instead:

$H(s_0, \bar{s_1}, s_2) = -s_0s_1 -s_1 s_2 + s_2 s_0$

A full problem is generated by adding clauses together:

$H(s_0, \dots, s_N) = H(s_0, s_1, s_2) + H(s_6, \bar{s_1}, s_4) + H(\bar{s_3}, s_5, \bar{s_9}) + \dots$

NAE3SAT problems are known to transition from the satisfiable to the unsatisfiable regime at a clause-to-variable ratio $\rho=2.1$. In this code example we solve problems with $\rho=2.1$ (critical point) as well as with $\rho=3.0$ (max-sat regime). Below we just show $\rho=3.0$ for simplicity.

## Embedding

Both the Pegasus and Zephyr topology have native graph triangles that allow embedding individual clauses directly (without chains). Nevertheless, a full problem typically includes interactions between variables that are not natively provided by the graph. This requires us to minor-embed the problems onto the QPU.

Here we minor-embed the problems into the two topologies using the `minorminer` heuristic in D-Wave Ocean. Below we show the distribution of chain lengths in the embeddings of a $\rho=3.0$.

![](/readme_images/rho_300_chain_length.png)

Note that the Zephyr topology of Advantage2_prototype has a greater connectivity than the Pegasus topology of Advantage. This allows minor-embedding problems more compactly (with shorter chains) in Advantage2_prototype. More compact embeddings typically improve the success of Quantum Annealing computations.

## Solution quality

Below we show the solution quality of 100 samples from a $\rho=3.0$ problem.

![](/readme_images/rho_300_energies.png)

We see that Advantage2_prototype tends to obtain lower energy samples than Advantage.
